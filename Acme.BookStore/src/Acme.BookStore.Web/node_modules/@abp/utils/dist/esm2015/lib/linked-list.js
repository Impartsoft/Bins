/* tslint:disable:no-non-null-assertion */
import compare from 'just-compare';
export class ListNode {
    constructor(value) {
        this.value = value;
    }
}
export class LinkedList {
    constructor() {
        this.size = 0;
    }
    get head() {
        return this.first;
    }
    get tail() {
        return this.last;
    }
    get length() {
        return this.size;
    }
    attach(value, previousNode, nextNode) {
        if (!previousNode)
            return this.addHead(value);
        if (!nextNode)
            return this.addTail(value);
        const node = new ListNode(value);
        node.previous = previousNode;
        previousNode.next = node;
        node.next = nextNode;
        nextNode.previous = node;
        this.size++;
        return node;
    }
    attachMany(values, previousNode, nextNode) {
        if (!values.length)
            return [];
        if (!previousNode)
            return this.addManyHead(values);
        if (!nextNode)
            return this.addManyTail(values);
        const list = new LinkedList();
        list.addManyTail(values);
        list.first.previous = previousNode;
        previousNode.next = list.first;
        list.last.next = nextNode;
        nextNode.previous = list.last;
        this.size += values.length;
        return list.toNodeArray();
    }
    detach(node) {
        if (!node.previous)
            return this.dropHead();
        if (!node.next)
            return this.dropTail();
        node.previous.next = node.next;
        node.next.previous = node.previous;
        this.size--;
        return node;
    }
    add(value) {
        return {
            after: (...params) => this.addAfter.call(this, value, ...params),
            before: (...params) => this.addBefore.call(this, value, ...params),
            byIndex: (position) => this.addByIndex(value, position),
            head: () => this.addHead(value),
            tail: () => this.addTail(value),
        };
    }
    addMany(values) {
        return {
            after: (...params) => this.addManyAfter.call(this, values, ...params),
            before: (...params) => this.addManyBefore.call(this, values, ...params),
            byIndex: (position) => this.addManyByIndex(values, position),
            head: () => this.addManyHead(values),
            tail: () => this.addManyTail(values),
        };
    }
    addAfter(value, previousValue, compareFn = compare) {
        const previous = this.find(node => compareFn(node.value, previousValue));
        return previous ? this.attach(value, previous, previous.next) : this.addTail(value);
    }
    addBefore(value, nextValue, compareFn = compare) {
        const next = this.find(node => compareFn(node.value, nextValue));
        return next ? this.attach(value, next.previous, next) : this.addHead(value);
    }
    addByIndex(value, position) {
        if (position < 0)
            position += this.size;
        else if (position >= this.size)
            return this.addTail(value);
        if (position <= 0)
            return this.addHead(value);
        const next = this.get(position);
        return this.attach(value, next.previous, next);
    }
    addHead(value) {
        const node = new ListNode(value);
        node.next = this.first;
        if (this.first)
            this.first.previous = node;
        else
            this.last = node;
        this.first = node;
        this.size++;
        return node;
    }
    addTail(value) {
        const node = new ListNode(value);
        if (this.first) {
            node.previous = this.last;
            this.last.next = node;
            this.last = node;
        }
        else {
            this.first = node;
            this.last = node;
        }
        this.size++;
        return node;
    }
    addManyAfter(values, previousValue, compareFn = compare) {
        const previous = this.find(node => compareFn(node.value, previousValue));
        return previous ? this.attachMany(values, previous, previous.next) : this.addManyTail(values);
    }
    addManyBefore(values, nextValue, compareFn = compare) {
        const next = this.find(node => compareFn(node.value, nextValue));
        return next ? this.attachMany(values, next.previous, next) : this.addManyHead(values);
    }
    addManyByIndex(values, position) {
        if (position < 0)
            position += this.size;
        if (position <= 0)
            return this.addManyHead(values);
        if (position >= this.size)
            return this.addManyTail(values);
        const next = this.get(position);
        return this.attachMany(values, next.previous, next);
    }
    addManyHead(values) {
        return values.reduceRight((nodes, value) => {
            nodes.unshift(this.addHead(value));
            return nodes;
        }, []);
    }
    addManyTail(values) {
        return values.map(value => this.addTail(value));
    }
    drop() {
        return {
            byIndex: (position) => this.dropByIndex(position),
            byValue: (...params) => this.dropByValue.apply(this, params),
            byValueAll: (...params) => this.dropByValueAll.apply(this, params),
            head: () => this.dropHead(),
            tail: () => this.dropTail(),
        };
    }
    dropMany(count) {
        return {
            byIndex: (position) => this.dropManyByIndex(count, position),
            head: () => this.dropManyHead(count),
            tail: () => this.dropManyTail(count),
        };
    }
    dropByIndex(position) {
        if (position < 0)
            position += this.size;
        const current = this.get(position);
        return current ? this.detach(current) : undefined;
    }
    dropByValue(value, compareFn = compare) {
        const position = this.findIndex(node => compareFn(node.value, value));
        return position < 0 ? undefined : this.dropByIndex(position);
    }
    dropByValueAll(value, compareFn = compare) {
        const dropped = [];
        for (let current = this.first, position = 0; current; position++, current = current.next) {
            if (compareFn(current.value, value)) {
                dropped.push(this.dropByIndex(position - dropped.length));
            }
        }
        return dropped;
    }
    dropHead() {
        const head = this.first;
        if (head) {
            this.first = head.next;
            if (this.first)
                this.first.previous = undefined;
            else
                this.last = undefined;
            this.size--;
            return head;
        }
        return undefined;
    }
    dropTail() {
        const tail = this.last;
        if (tail) {
            this.last = tail.previous;
            if (this.last)
                this.last.next = undefined;
            else
                this.first = undefined;
            this.size--;
            return tail;
        }
        return undefined;
    }
    dropManyByIndex(count, position) {
        if (count <= 0)
            return [];
        if (position < 0)
            position = Math.max(position + this.size, 0);
        else if (position >= this.size)
            return [];
        count = Math.min(count, this.size - position);
        const dropped = [];
        while (count--) {
            const current = this.get(position);
            dropped.push(this.detach(current));
        }
        return dropped;
    }
    dropManyHead(count) {
        if (count <= 0)
            return [];
        count = Math.min(count, this.size);
        const dropped = [];
        while (count--)
            dropped.unshift(this.dropHead());
        return dropped;
    }
    dropManyTail(count) {
        if (count <= 0)
            return [];
        count = Math.min(count, this.size);
        const dropped = [];
        while (count--)
            dropped.push(this.dropTail());
        return dropped;
    }
    find(predicate) {
        for (let current = this.first, position = 0; current; position++, current = current.next) {
            if (predicate(current, position, this))
                return current;
        }
        return undefined;
    }
    findIndex(predicate) {
        for (let current = this.first, position = 0; current; position++, current = current.next) {
            if (predicate(current, position, this))
                return position;
        }
        return -1;
    }
    forEach(iteratorFn) {
        for (let node = this.first, position = 0; node; position++, node = node.next) {
            iteratorFn(node, position, this);
        }
    }
    get(position) {
        return this.find((_, index) => position === index);
    }
    indexOf(value, compareFn = compare) {
        return this.findIndex(node => compareFn(node.value, value));
    }
    toArray() {
        const array = new Array(this.size);
        this.forEach((node, index) => (array[index] = node.value));
        return array;
    }
    toNodeArray() {
        const array = new Array(this.size);
        this.forEach((node, index) => (array[index] = node));
        return array;
    }
    toString(mapperFn = JSON.stringify) {
        return this.toArray()
            .map(value => mapperFn(value))
            .join(' <-> ');
    }
    // Cannot use Generator type because of ng-packagr
    *[Symbol.iterator]() {
        for (let node = this.first, position = 0; node; position++, node = node.next) {
            yield node.value;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlua2VkLWxpc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9wcm9qZWN0cy91dGlscy9zcmMvbGliL2xpbmtlZC1saXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDBDQUEwQztBQUUxQyxPQUFPLE9BQU8sTUFBTSxjQUFjLENBQUM7QUFFbkMsTUFBTSxPQUFPLFFBQVE7SUFHbkIsWUFBNEIsS0FBUTtRQUFSLFVBQUssR0FBTCxLQUFLLENBQUc7SUFBRyxDQUFDO0NBQ3pDO0FBRUQsTUFBTSxPQUFPLFVBQVU7SUFBdkI7UUFHVSxTQUFJLEdBQUcsQ0FBQyxDQUFDO0lBK1huQixDQUFDO0lBN1hDLElBQUksSUFBSTtRQUNOLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztJQUNwQixDQUFDO0lBQ0QsSUFBSSxJQUFJO1FBQ04sT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQ25CLENBQUM7SUFDRCxJQUFJLE1BQU07UUFDUixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDbkIsQ0FBQztJQUVPLE1BQU0sQ0FDWixLQUFRLEVBQ1IsWUFBcUMsRUFDckMsUUFBaUM7UUFFakMsSUFBSSxDQUFDLFlBQVk7WUFBRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFOUMsSUFBSSxDQUFDLFFBQVE7WUFBRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFMUMsTUFBTSxJQUFJLEdBQUcsSUFBSSxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLFFBQVEsR0FBRyxZQUFZLENBQUM7UUFDN0IsWUFBWSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDekIsSUFBSSxDQUFDLElBQUksR0FBRyxRQUFRLENBQUM7UUFDckIsUUFBUSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFFekIsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBRVosT0FB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LEVBQUUsRUFBRSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRTtZQUM1RSxNQUFNLElBQUksQ0FBQyxLQUFLLENBQUM7U0FDbEI7SUFDSCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIvKiB0c2xpbnQ6ZGlzYWJsZTpuby1ub24tbnVsbC1hc3NlcnRpb24gKi9cblxuaW1wb3J0IGNvbXBhcmUgZnJvbSAnanVzdC1jb21wYXJlJztcblxuZXhwb3J0IGNsYXNzIExpc3ROb2RlPFQgPSBhbnk+IHtcbiAgbmV4dDogTGlzdE5vZGUgfCB1bmRlZmluZWQ7XG4gIHByZXZpb3VzOiBMaXN0Tm9kZSB8IHVuZGVmaW5lZDtcbiAgY29uc3RydWN0b3IocHVibGljIHJlYWRvbmx5IHZhbHVlOiBUKSB7fVxufVxuXG5leHBvcnQgY2xhc3MgTGlua2VkTGlzdDxUID0gYW55PiB7XG4gIHByaXZhdGUgZmlyc3Q6IExpc3ROb2RlPFQ+IHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIGxhc3Q6IExpc3ROb2RlPFQ+IHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIHNpemUgPSAwO1xuXG4gIGdldCBoZWFkKCk6IExpc3ROb2RlPFQ+IHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5maXJzdDtcbiAgfVxuICBnZXQgdGFpbCgpOiBMaXN0Tm9kZTxUPiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMubGFzdDtcbiAgfVxuICBnZXQgbGVuZ3RoKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuc2l6ZTtcbiAgfVxuXG4gIHByaXZhdGUgYXR0YWNoKFxuICAgIHZhbHVlOiBULFxuICAgIHByZXZpb3VzTm9kZTogTGlzdE5vZGU8VD4gfCB1bmRlZmluZWQsXG4gICAgbmV4dE5vZGU6IExpc3ROb2RlPFQ+IHwgdW5kZWZpbmVkLFxuICApOiBMaXN0Tm9kZTxUPiB7XG4gICAgaWYgKCFwcmV2aW91c05vZGUpIHJldHVybiB0aGlzLmFkZEhlYWQodmFsdWUpO1xuXG4gICAgaWYgKCFuZXh0Tm9kZSkgcmV0dXJuIHRoaXMuYWRkVGFpbCh2YWx1ZSk7XG5cbiAgICBjb25zdCBub2RlID0gbmV3IExpc3ROb2RlKHZhbHVlKTtcbiAgICBub2RlLnByZXZpb3VzID0gcHJldmlvdXNOb2RlO1xuICAgIHByZXZpb3VzTm9kZS5uZXh0ID0gbm9kZTtcbiAgICBub2RlLm5leHQgPSBuZXh0Tm9kZTtcbiAgICBuZXh0Tm9kZS5wcmV2aW91cyA9IG5vZGU7XG5cbiAgICB0aGlzLnNpemUrKztcblxuICAgIHJldHVybiBub2RlO1xuICB9XG5cbiAgcHJpdmF0ZSBhdHRhY2hNYW55KFxuICAgIHZhbHVlczogVFtdLFxuICAgIHByZXZpb3VzTm9kZTogTGlzdE5vZGU8VD4gfCB1bmRlZmluZWQsXG4gICAgbmV4dE5vZGU6IExpc3ROb2RlPFQ+IHwgdW5kZWZpbmVkLFxuICApOiBMaXN0Tm9kZTxUPltdIHtcbiAgICBpZiAoIXZhbHVlcy5sZW5ndGgpIHJldHVybiBbXTtcblxuICAgIGlmICghcHJldmlvdXNOb2RlKSByZXR1cm4gdGhpcy5hZGRNYW55SGVhZCh2YWx1ZXMpO1xuXG4gICAgaWYgKCFuZXh0Tm9kZSkgcmV0dXJuIHRoaXMuYWRkTWFueVRhaWwodmFsdWVzKTtcblxuICAgIGNvbnN0IGxpc3QgPSBuZXcgTGlua2VkTGlzdDxUPigpO1xuICAgIGxpc3QuYWRkTWFueVRhaWwodmFsdWVzKTtcbiAgICBsaXN0LmZpcnN0IS5wcmV2aW91cyA9IHByZXZpb3VzTm9kZTtcbiAgICBwcmV2aW91c05vZGUubmV4dCA9IGxpc3QuZmlyc3Q7XG4gICAgbGlzdC5sYXN0IS5uZXh0ID0gbmV4dE5vZGU7XG4gICAgbmV4dE5vZGUucHJldmlvdXMgPSBsaXN0Lmxhc3Q7XG5cbiAgICB0aGlzLnNpemUgKz0gdmFsdWVzLmxlbmd0aDtcblxuICAgIHJldHVybiBsaXN0LnRvTm9kZUFycmF5KCk7XG4gIH1cblxuICBwcml2YXRlIGRldGFjaChub2RlOiBMaXN0Tm9kZTxUPikge1xuICAgIGlmICghbm9kZS5wcmV2aW91cykgcmV0dXJuIHRoaXMuZHJvcEhlYWQoKTtcblxuICAgIGlmICghbm9kZS5uZXh0KSByZXR1cm4gdGhpcy5kcm9wVGFpbCgpO1xuXG4gICAgbm9kZS5wcmV2aW91cy5uZXh0ID0gbm9kZS5uZXh0O1xuICAgIG5vZGUubmV4dC5wcmV2aW91cyA9IG5vZGUucHJldmlvdXM7XG5cbiAgICB0aGlzLnNpemUtLTtcblxuICAgIHJldHVybiBub2RlO1xuICB9XG5cbiAgYWRkKHZhbHVlOiBUKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFmdGVyOiAoLi4ucGFyYW1zOiBbVF0gfCBbYW55LCBMaXN0Q29tcGFyaXNvbkZuPFQ+XSkgPT5cbiAgICAgICAgdGhpcy5hZGRBZnRlci5jYWxsKHRoaXMsIHZhbHVlLCAuLi5wYXJhbXMpLFxuICAgICAgYmVmb3JlOiAoLi4ucGFyYW1zOiBbVF0gfCBbYW55LCBMaXN0Q29tcGFyaXNvbkZuPFQ+XSkgPT5cbiAgICAgICAgdGhpcy5hZGRCZWZvcmUuY2FsbCh0aGlzLCB2YWx1ZSwgLi4ucGFyYW1zKSxcbiAgICAgIGJ5SW5kZXg6IChwb3NpdGlvbjogbnVtYmVyKSA9PiB0aGlzLmFkZEJ5SW5kZXgodmFsdWUsIHBvc2l0aW9uKSxcbiAgICAgIGhlYWQ6ICgpID0+IHRoaXMuYWRkSGVhZCh2YWx1ZSksXG4gICAgICB0YWlsOiAoKSA9PiB0aGlzLmFkZFRhaWwodmFsdWUpLFxuICAgIH07XG4gIH1cblxuICBhZGRNYW55KHZhbHVlczogVFtdKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFmdGVyOiAoLi4ucGFyYW1zOiBbVF0gfCBbYW55LCBMaXN0Q29tcGFyaXNvbkZuPFQ+XSkgPT5cbiAgICAgICAgdGhpcy5hZGRNYW55QWZ0ZXIuY2FsbCh0aGlzLCB2YWx1ZXMsIC4uLnBhcmFtcyksXG4gICAgICBiZWZvcmU6ICguLi5wYXJhbXM6IFtUXSB8IFthbnksIExpc3RDb21wYXJpc29uRm48VD5dKSA9PlxuICAgICAgICB0aGlzLmFkZE1hbnlCZWZvcmUuY2FsbCh0aGlzLCB2YWx1ZXMsIC4uLnBhcmFtcyksXG4gICAgICBieUluZGV4OiAocG9zaXRpb246IG51bWJlcikgPT4gdGhpcy5hZGRNYW55QnlJbmRleCh2YWx1ZXMsIHBvc2l0aW9uKSxcbiAgICAgIGhlYWQ6ICgpID0+IHRoaXMuYWRkTWFueUhlYWQodmFsdWVzKSxcbiAgICAgIHRhaWw6ICgpID0+IHRoaXMuYWRkTWFueVRhaWwodmFsdWVzKSxcbiAgICB9O1xuICB9XG5cbiAgYWRkQWZ0ZXIodmFsdWU6IFQsIHByZXZpb3VzVmFsdWU6IFQpOiBMaXN0Tm9kZTxUPjtcbiAgYWRkQWZ0ZXIodmFsdWU6IFQsIHByZXZpb3VzVmFsdWU6IGFueSwgY29tcGFyZUZuOiBMaXN0Q29tcGFyaXNvbkZuPFQ+KTogTGlzdE5vZGU8VD47XG4gIGFkZEFmdGVyKHZhbHVlOiBULCBwcmV2aW91c1ZhbHVlOiBhbnksIGNvbXBhcmVGbjogTGlzdENvbXBhcmlzb25GbjxUPiA9IGNvbXBhcmUpOiBMaXN0Tm9kZTxUPiB7XG4gICAgY29uc3QgcHJldmlvdXMgPSB0aGlzLmZpbmQobm9kZSA9PiBjb21wYXJlRm4obm9kZS52YWx1ZSwgcHJldmlvdXNWYWx1ZSkpO1xuXG4gICAgcmV0dXJuIHByZXZpb3VzID8gdGhpcy5hdHRhY2godmFsdWUsIHByZXZpb3VzLCBwcmV2aW91cy5uZXh0KSA6IHRoaXMuYWRkVGFpbCh2YWx1ZSk7XG4gIH1cblxuICBhZGRCZWZvcmUodmFsdWU6IFQsIG5leHRWYWx1ZTogVCk6IExpc3ROb2RlPFQ+O1xuICBhZGRCZWZvcmUodmFsdWU6IFQsIG5leHRWYWx1ZTogYW55LCBjb21wYXJlRm46IExpc3RDb21wYXJpc29uRm48VD4pOiBMaXN0Tm9kZTxUPjtcbiAgYWRkQmVmb3JlKHZhbHVlOiBULCBuZXh0VmFsdWU6IGFueSwgY29tcGFyZUZuOiBMaXN0Q29tcGFyaXNvbkZuPFQ+ID0gY29tcGFyZSk6IExpc3ROb2RlPFQ+IHtcbiAgICBjb25zdCBuZXh0ID0gdGhpcy5maW5kKG5vZGUgPT4gY29tcGFyZUZuKG5vZGUudmFsdWUsIG5leHRWYWx1ZSkpO1xuXG4gICAgcmV0dXJuIG5leHQgPyB0aGlzLmF0dGFjaCh2YWx1ZSwgbmV4dC5wcmV2aW91cywgbmV4dCkgOiB0aGlzLmFkZEhlYWQodmFsdWUpO1xuICB9XG5cbiAgYWRkQnlJbmRleCh2YWx1ZTogVCwgcG9zaXRpb246IG51bWJlcik6IExpc3ROb2RlPFQ+IHtcbiAgICBpZiAocG9zaXRpb24gPCAwKSBwb3NpdGlvbiArPSB0aGlzLnNpemU7XG4gICAgZWxzZSBpZiAocG9zaXRpb24gPj0gdGhpcy5zaXplKSByZXR1cm4gdGhpcy5hZGRUYWlsKHZhbHVlKTtcblxuICAgIGlmIChwb3NpdGlvbiA8PSAwKSByZXR1cm4gdGhpcy5hZGRIZWFkKHZhbHVlKTtcblxuICAgIGNvbnN0IG5leHQgPSB0aGlzLmdldChwb3NpdGlvbikhO1xuXG4gICAgcmV0dXJuIHRoaXMuYXR0YWNoKHZhbHVlLCBuZXh0LnByZXZpb3VzLCBuZXh0KTtcbiAgfVxuXG4gIGFkZEhlYWQodmFsdWU6IFQpOiBMaXN0Tm9kZTxUPiB7XG4gICAgY29uc3Qgbm9kZSA9IG5ldyBMaXN0Tm9kZSh2YWx1ZSk7XG5cbiAgICBub2RlLm5leHQgPSB0aGlzLmZpcnN0O1xuXG4gICAgaWYgKHRoaXMuZmlyc3QpIHRoaXMuZmlyc3QucHJldmlvdXMgPSBub2RlO1xuICAgIGVsc2UgdGhpcy5sYXN0ID0gbm9kZTtcblxuICAgIHRoaXMuZmlyc3QgPSBub2RlO1xuICAgIHRoaXMuc2l6ZSsrO1xuXG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICBhZGRUYWlsKHZhbHVlOiBUKTogTGlzdE5vZGU8VD4ge1xuICAgIGNvbnN0IG5vZGUgPSBuZXcgTGlzdE5vZGUodmFsdWUpO1xuXG4gICAgaWYgKHRoaXMuZmlyc3QpIHtcbiAgICAgIG5vZGUucHJldmlvdXMgPSB0aGlzLmxhc3Q7XG4gICAgICB0aGlzLmxhc3QhLm5leHQgPSBub2RlO1xuICAgICAgdGhpcy5sYXN0ID0gbm9kZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5maXJzdCA9IG5vZGU7XG4gICAgICB0aGlzLmxhc3QgPSBub2RlO1xuICAgIH1cblxuICAgIHRoaXMuc2l6ZSsrO1xuXG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICBhZGRNYW55QWZ0ZXIodmFsdWVzOiBUW10sIHByZXZpb3VzVmFsdWU6IFQpOiBMaXN0Tm9kZTxUPltdO1xuICBhZGRNYW55QWZ0ZXIodmFsdWVzOiBUW10sIHByZXZpb3VzVmFsdWU6IGFueSwgY29tcGFyZUZuOiBMaXN0Q29tcGFyaXNvbkZuPFQ+KTogTGlzdE5vZGU8VD5bXTtcbiAgYWRkTWFueUFmdGVyKFxuICAgIHZhbHVlczogVFtdLFxuICAgIHByZXZpb3VzVmFsdWU6IGFueSxcbiAgICBjb21wYXJlRm46IExpc3RDb21wYXJpc29uRm48VD4gPSBjb21wYXJlLFxuICApOiBMaXN0Tm9kZTxUPltdIHtcbiAgICBjb25zdCBwcmV2aW91cyA9IHRoaXMuZmluZChub2RlID0+IGNvbXBhcmVGbihub2RlLnZhbHVlLCBwcmV2aW91c1ZhbHVlKSk7XG5cbiAgICByZXR1cm4gcHJldmlvdXMgPyB0aGlzLmF0dGFjaE1hbnkodmFsdWVzLCBwcmV2aW91cywgcHJldmlvdXMubmV4dCkgOiB0aGlzLmFkZE1hbnlUYWlsKHZhbHVlcyk7XG4gIH1cblxuICBhZGRNYW55QmVmb3JlKHZhbHVlczogVFtdLCBuZXh0VmFsdWU6IFQpOiBMaXN0Tm9kZTxUPltdO1xuICBhZGRNYW55QmVmb3JlKHZhbHVlczogVFtdLCBuZXh0VmFsdWU6IGFueSwgY29tcGFyZUZuOiBMaXN0Q29tcGFyaXNvbkZuPFQ+KTogTGlzdE5vZGU8VD5bXTtcbiAgYWRkTWFueUJlZm9yZShcbiAgICB2YWx1ZXM6IFRbXSxcbiAgICBuZXh0VmFsdWU6IGFueSxcbiAgICBjb21wYXJlRm46IExpc3RDb21wYXJpc29uRm48VD4gPSBjb21wYXJlLFxuICApOiBMaXN0Tm9kZTxUPltdIHtcbiAgICBjb25zdCBuZXh0ID0gdGhpcy5maW5kKG5vZGUgPT4gY29tcGFyZUZuKG5vZGUudmFsdWUsIG5leHRWYWx1ZSkpO1xuXG4gICAgcmV0dXJuIG5leHQgPyB0aGlzLmF0dGFjaE1hbnkodmFsdWVzLCBuZXh0LnByZXZpb3VzLCBuZXh0KSA6IHRoaXMuYWRkTWFueUhlYWQodmFsdWVzKTtcbiAgfVxuXG4gIGFkZE1hbnlCeUluZGV4KHZhbHVlczogVFtdLCBwb3NpdGlvbjogbnVtYmVyKTogTGlzdE5vZGU8VD5bXSB7XG4gICAgaWYgKHBvc2l0aW9uIDwgMCkgcG9zaXRpb24gKz0gdGhpcy5zaXplO1xuXG4gICAgaWYgKHBvc2l0aW9uIDw9IDApIHJldHVybiB0aGlzLmFkZE1hbnlIZWFkKHZhbHVlcyk7XG5cbiAgICBpZiAocG9zaXRpb24gPj0gdGhpcy5zaXplKSByZXR1cm4gdGhpcy5hZGRNYW55VGFpbCh2YWx1ZXMpO1xuXG4gICAgY29uc3QgbmV4dCA9IHRoaXMuZ2V0KHBvc2l0aW9uKSE7XG5cbiAgICByZXR1cm4gdGhpcy5hdHRhY2hNYW55KHZhbHVlcywgbmV4dC5wcmV2aW91cywgbmV4dCk7XG4gIH1cblxuICBhZGRNYW55SGVhZCh2YWx1ZXM6IFRbXSk6IExpc3ROb2RlPFQ+W10ge1xuICAgIHJldHVybiB2YWx1ZXMucmVkdWNlUmlnaHQ8TGlzdE5vZGU8VD5bXT4oKG5vZGVzLCB2YWx1ZSkgPT4ge1xuICAgICAgbm9kZXMudW5zaGlmdCh0aGlzLmFkZEhlYWQodmFsdWUpKTtcbiAgICAgIHJldHVybiBub2RlcztcbiAgICB9LCBbXSk7XG4gIH1cblxuICBhZGRNYW55VGFpbCh2YWx1ZXM6IFRbXSk6IExpc3ROb2RlPFQ+W10ge1xuICAgIHJldHVybiB2YWx1ZXMubWFwKHZhbHVlID0+IHRoaXMuYWRkVGFpbCh2YWx1ZSkpO1xuICB9XG5cbiAgZHJvcCgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYnlJbmRleDogKHBvc2l0aW9uOiBudW1iZXIpID0+IHRoaXMuZHJvcEJ5SW5kZXgocG9zaXRpb24pLFxuICAgICAgYnlWYWx1ZTogKC4uLnBhcmFtczogW1RdIHwgW2FueSwgTGlzdENvbXBhcmlzb25GbjxUPl0pID0+XG4gICAgICAgIHRoaXMuZHJvcEJ5VmFsdWUuYXBwbHkodGhpcywgcGFyYW1zKSxcbiAgICAgIGJ5VmFsdWVBbGw6ICguLi5wYXJhbXM6IFtUXSB8IFthbnksIExpc3RDb21wYXJpc29uRm48VD5dKSA9PlxuICAgICAgICB0aGlzLmRyb3BCeVZhbHVlQWxsLmFwcGx5KHRoaXMsIHBhcmFtcyksXG4gICAgICBoZWFkOiAoKSA9PiB0aGlzLmRyb3BIZWFkKCksXG4gICAgICB0YWlsOiAoKSA9PiB0aGlzLmRyb3BUYWlsKCksXG4gICAgfTtcbiAgfVxuXG4gIGRyb3BNYW55KGNvdW50OiBudW1iZXIpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYnlJbmRleDogKHBvc2l0aW9uOiBudW1iZXIpID0+IHRoaXMuZHJvcE1hbnlCeUluZGV4KGNvdW50LCBwb3NpdGlvbiksXG4gICAgICBoZWFkOiAoKSA9PiB0aGlzLmRyb3BNYW55SGVhZChjb3VudCksXG4gICAgICB0YWlsOiAoKSA9PiB0aGlzLmRyb3BNYW55VGFpbChjb3VudCksXG4gICAgfTtcbiAgfVxuXG4gIGRyb3BCeUluZGV4KHBvc2l0aW9uOiBudW1iZXIpOiBMaXN0Tm9kZTxUPiB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKHBvc2l0aW9uIDwgMCkgcG9zaXRpb24gKz0gdGhpcy5zaXplO1xuXG4gICAgY29uc3QgY3VycmVudCA9IHRoaXMuZ2V0KHBvc2l0aW9uKTtcblxuICAgIHJldHVybiBjdXJyZW50ID8gdGhpcy5kZXRhY2goY3VycmVudCkgOiB1bmRlZmluZWQ7XG4gIH1cblxuICBkcm9wQnlWYWx1ZSh2YWx1ZTogVCk6IExpc3ROb2RlPFQ+IHwgdW5kZWZpbmVkO1xuICBkcm9wQnlWYWx1ZSh2YWx1ZTogYW55LCBjb21wYXJlRm46IExpc3RDb21wYXJpc29uRm48VD4pOiBMaXN0Tm9kZTxUPiB8IHVuZGVmaW5lZDtcbiAgZHJvcEJ5VmFsdWUodmFsdWU6IGFueSwgY29tcGFyZUZuOiBMaXN0Q29tcGFyaXNvbkZuPFQ+ID0gY29tcGFyZSk6IExpc3ROb2RlPFQ+IHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMuZmluZEluZGV4KG5vZGUgPT4gY29tcGFyZUZuKG5vZGUudmFsdWUsIHZhbHVlKSk7XG5cbiAgICByZXR1cm4gcG9zaXRpb24gPCAwID8gdW5kZWZpbmVkIDogdGhpcy5kcm9wQnlJbmRleChwb3NpdGlvbik7XG4gIH1cblxuICBkcm9wQnlWYWx1ZUFsbCh2YWx1ZTogVCk6IExpc3ROb2RlPFQ+W107XG4gIGRyb3BCeVZhbHVlQWxsKHZhbHVlOiBhbnksIGNvbXBhcmVGbjogTGlzdENvbXBhcmlzb25GbjxUPik6IExpc3ROb2RlPFQ+W107XG4gIGRyb3BCeVZhbHVlQWxsKHZhbHVlOiBhbnksIGNvbXBhcmVGbjogTGlzdENvbXBhcmlzb25GbjxUPiA9IGNvbXBhcmUpOiBMaXN0Tm9kZTxUPltdIHtcbiAgICBjb25zdCBkcm9wcGVkOiBMaXN0Tm9kZTxUPltdID0gW107XG5cbiAgICBmb3IgKGxldCBjdXJyZW50ID0gdGhpcy5maXJzdCwgcG9zaXRpb24gPSAwOyBjdXJyZW50OyBwb3NpdGlvbisrLCBjdXJyZW50ID0gY3VycmVudC5uZXh0KSB7XG4gICAgICBpZiAoY29tcGFyZUZuKGN1cnJlbnQudmFsdWUsIHZhbHVlKSkge1xuICAgICAgICBkcm9wcGVkLnB1c2godGhpcy5kcm9wQnlJbmRleChwb3NpdGlvbiAtIGRyb3BwZWQubGVuZ3RoKSEpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBkcm9wcGVkO1xuICB9XG5cbiAgZHJvcEhlYWQoKTogTGlzdE5vZGU8VD4gfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IGhlYWQgPSB0aGlzLmZpcnN0O1xuXG4gICAgaWYgKGhlYWQpIHtcbiAgICAgIHRoaXMuZmlyc3QgPSBoZWFkLm5leHQ7XG5cbiAgICAgIGlmICh0aGlzLmZpcnN0KSB0aGlzLmZpcnN0LnByZXZpb3VzID0gdW5kZWZpbmVkO1xuICAgICAgZWxzZSB0aGlzLmxhc3QgPSB1bmRlZmluZWQ7XG5cbiAgICAgIHRoaXMuc2l6ZS0tO1xuXG4gICAgICByZXR1cm4gaGVhZDtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgZHJvcFRhaWwoKTogTGlzdE5vZGU8VD4gfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IHRhaWwgPSB0aGlzLmxhc3Q7XG5cbiAgICBpZiAodGFpbCkge1xuICAgICAgdGhpcy5sYXN0ID0gdGFpbC5wcmV2aW91cztcblxuICAgICAgaWYgKHRoaXMubGFzdCkgdGhpcy5sYXN0Lm5leHQgPSB1bmRlZmluZWQ7XG4gICAgICBlbHNlIHRoaXMuZmlyc3QgPSB1bmRlZmluZWQ7XG5cbiAgICAgIHRoaXMuc2l6ZS0tO1xuXG4gICAgICByZXR1cm4gdGFpbDtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgZHJvcE1hbnlCeUluZGV4KGNvdW50OiBudW1iZXIsIHBvc2l0aW9uOiBudW1iZXIpOiBMaXN0Tm9kZTxUPltdIHtcbiAgICBpZiAoY291bnQgPD0gMCkgcmV0dXJuIFtdO1xuXG4gICAgaWYgKHBvc2l0aW9uIDwgMCkgcG9zaXRpb24gPSBNYXRoLm1heChwb3NpdGlvbiArIHRoaXMuc2l6ZSwgMCk7XG4gICAgZWxzZSBpZiAocG9zaXRpb24gPj0gdGhpcy5zaXplKSByZXR1cm4gW107XG5cbiAgICBjb3VudCA9IE1hdGgubWluKGNvdW50LCB0aGlzLnNpemUgLSBwb3NpdGlvbik7XG5cbiAgICBjb25zdCBkcm9wcGVkOiBMaXN0Tm9kZTxUPltdID0gW107XG5cbiAgICB3aGlsZSAoY291bnQtLSkge1xuICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuZ2V0KHBvc2l0aW9uKTtcbiAgICAgIGRyb3BwZWQucHVzaCh0aGlzLmRldGFjaChjdXJyZW50ISkhKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZHJvcHBlZDtcbiAgfVxuXG4gIGRyb3BNYW55SGVhZChjb3VudDogRXhjbHVkZTxudW1iZXIsIDA+KTogTGlzdE5vZGU8VD5bXSB7XG4gICAgaWYgKGNvdW50IDw9IDApIHJldHVybiBbXTtcblxuICAgIGNvdW50ID0gTWF0aC5taW4oY291bnQsIHRoaXMuc2l6ZSk7XG5cbiAgICBjb25zdCBkcm9wcGVkOiBMaXN0Tm9kZTxUPltdID0gW107XG5cbiAgICB3aGlsZSAoY291bnQtLSkgZHJvcHBlZC51bnNoaWZ0KHRoaXMuZHJvcEhlYWQoKSEpO1xuXG4gICAgcmV0dXJuIGRyb3BwZWQ7XG4gIH1cblxuICBkcm9wTWFueVRhaWwoY291bnQ6IEV4Y2x1ZGU8bnVtYmVyLCAwPik6IExpc3ROb2RlPFQ+W10ge1xuICAgIGlmIChjb3VudCA8PSAwKSByZXR1cm4gW107XG5cbiAgICBjb3VudCA9IE1hdGgubWluKGNvdW50LCB0aGlzLnNpemUpO1xuXG4gICAgY29uc3QgZHJvcHBlZDogTGlzdE5vZGU8VD5bXSA9IFtdO1xuXG4gICAgd2hpbGUgKGNvdW50LS0pIGRyb3BwZWQucHVzaCh0aGlzLmRyb3BUYWlsKCkhKTtcblxuICAgIHJldHVybiBkcm9wcGVkO1xuICB9XG5cbiAgZmluZChwcmVkaWNhdGU6IExpc3RJdGVyYXRvckZuPFQ+KTogTGlzdE5vZGU8VD4gfCB1bmRlZmluZWQge1xuICAgIGZvciAobGV0IGN1cnJlbnQgPSB0aGlzLmZpcnN0LCBwb3NpdGlvbiA9IDA7IGN1cnJlbnQ7IHBvc2l0aW9uKyssIGN1cnJlbnQgPSBjdXJyZW50Lm5leHQpIHtcbiAgICAgIGlmIChwcmVkaWNhdGUoY3VycmVudCwgcG9zaXRpb24sIHRoaXMpKSByZXR1cm4gY3VycmVudDtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgZmluZEluZGV4KHByZWRpY2F0ZTogTGlzdEl0ZXJhdG9yRm48VD4pOiBudW1iZXIge1xuICAgIGZvciAobGV0IGN1cnJlbnQgPSB0aGlzLmZpcnN0LCBwb3NpdGlvbiA9IDA7IGN1cnJlbnQ7IHBvc2l0aW9uKyssIGN1cnJlbnQgPSBjdXJyZW50Lm5leHQpIHtcbiAgICAgIGlmIChwcmVkaWNhdGUoY3VycmVudCwgcG9zaXRpb24sIHRoaXMpKSByZXR1cm4gcG9zaXRpb247XG4gICAgfVxuXG4gICAgcmV0dXJuIC0xO1xuICB9XG5cbiAgZm9yRWFjaDxSID0gYm9vbGVhbj4oaXRlcmF0b3JGbjogTGlzdEl0ZXJhdG9yRm48VCwgUj4pIHtcbiAgICBmb3IgKGxldCBub2RlID0gdGhpcy5maXJzdCwgcG9zaXRpb24gPSAwOyBub2RlOyBwb3NpdGlvbisrLCBub2RlID0gbm9kZS5uZXh0KSB7XG4gICAgICBpdGVyYXRvckZuKG5vZGUsIHBvc2l0aW9uLCB0aGlzKTtcbiAgICB9XG4gIH1cblxuICBnZXQocG9zaXRpb246IG51bWJlcik6IExpc3ROb2RlPFQ+IHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5maW5kKChfLCBpbmRleCkgPT4gcG9zaXRpb24gPT09IGluZGV4KTtcbiAgfVxuXG4gIGluZGV4T2YodmFsdWU6IFQpOiBudW1iZXI7XG4gIGluZGV4T2YodmFsdWU6IGFueSwgY29tcGFyZUZuOiBMaXN0Q29tcGFyaXNvbkZuPFQ+KTogbnVtYmVyO1xuICBpbmRleE9mKHZhbHVlOiBhbnksIGNvbXBhcmVGbjogTGlzdENvbXBhcmlzb25GbjxUPiA9IGNvbXBhcmUpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmZpbmRJbmRleChub2RlID0+IGNvbXBhcmVGbihub2RlLnZhbHVlLCB2YWx1ZSkpO1xuICB9XG5cbiAgdG9BcnJheSgpOiBUW10ge1xuICAgIGNvbnN0IGFycmF5ID0gbmV3IEFycmF5KHRoaXMuc2l6ZSk7XG5cbiAgICB0aGlzLmZvckVhY2goKG5vZGUsIGluZGV4KSA9PiAoYXJyYXlbaW5kZXghXSA9IG5vZGUudmFsdWUpKTtcblxuICAgIHJldHVybiBhcnJheTtcbiAgfVxuXG4gIHRvTm9kZUFycmF5KCk6IExpc3ROb2RlPFQ+W10ge1xuICAgIGNvbnN0IGFycmF5ID0gbmV3IEFycmF5KHRoaXMuc2l6ZSk7XG5cbiAgICB0aGlzLmZvckVhY2goKG5vZGUsIGluZGV4KSA9PiAoYXJyYXlbaW5kZXghXSA9IG5vZGUpKTtcblxuICAgIHJldHVybiBhcnJheTtcbiAgfVxuXG4gIHRvU3RyaW5nKG1hcHBlckZuOiBMaXN0TWFwcGVyRm48VD4gPSBKU09OLnN0cmluZ2lmeSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMudG9BcnJheSgpXG4gICAgICAubWFwKHZhbHVlID0+IG1hcHBlckZuKHZhbHVlKSlcbiAgICAgIC5qb2luKCcgPC0+ICcpO1xuICB9XG5cbiAgLy8gQ2Fubm90IHVzZSBHZW5lcmF0b3IgdHlwZSBiZWNhdXNlIG9mIG5nLXBhY2thZ3JcbiAgKltTeW1ib2wuaXRlcmF0b3JdKCk6IGFueSB7XG4gICAgZm9yIChsZXQgbm9kZSA9IHRoaXMuZmlyc3QsIHBvc2l0aW9uID0gMDsgbm9kZTsgcG9zaXRpb24rKywgbm9kZSA9IG5vZGUubmV4dCkge1xuICAgICAgeWllbGQgbm9kZS52YWx1ZTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IHR5cGUgTGlzdE1hcHBlckZuPFQgPSBhbnk+ID0gKHZhbHVlOiBUKSA9PiBhbnk7XG5cbmV4cG9ydCB0eXBlIExpc3RDb21wYXJpc29uRm48VCA9IGFueT4gPSAodmFsdWUxOiBULCB2YWx1ZTI6IGFueSkgPT4gYm9vbGVhbjtcblxuZXhwb3J0IHR5cGUgTGlzdEl0ZXJhdG9yRm48VCA9IGFueSwgUiA9IGJvb2xlYW4+ID0gKFxuICBub2RlOiBMaXN0Tm9kZTxUPixcbiAgaW5kZXg/OiBudW1iZXIsXG4gIGxpc3Q/OiBMaW5rZWRMaXN0LFxuKSA9PiBSO1xuIl19